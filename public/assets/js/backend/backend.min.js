Backend.Views.OrderAnalyticsView=Backbone.View.extend({el:"#order-analytics",ui:{orderoverview:"#order-chart",orderdistribution:"#order-distribution"},events:{"click .change-data":"changeData"},setUpUi:function(){var a=this;_.each(_.keys(a.ui),function(b){var c=a.ui[b];this.ui[b]=$(c)},this)},initialize:function(){this.setUpUi();var a=this.formatOrderOverviewData(Backend.data.orders.month);this.drawOverviewChart(a);var b=this.formatDistributionData(Backend.data.distribution.month);this.drawDistributionChart(b)},formatOrderOverviewData:function(a){var b=new Array;return _.each(a,function(a){var c={day:a.day,value:a.orders};b.push(c)}),b},formatDistributionData:function(a){var b=[{label:"Fulfilled Orders",value:a.fulfilled},{label:"Verified Orders",value:a.verified},{label:"Placed Orders",value:a.placed}];return b},drawOverviewChart:function(a){this.ui.orderoverview.html("");Morris.Area({element:"order-chart",data:a,xkey:"day",ykeys:["value"],labels:["Orders"],lineColors:["#0090d9"],lineWidth:"0",grid:"false",fillOpacity:"0.5"})},drawDistributionChart:function(a){this.ui.orderdistribution.html("");Morris.Donut({element:"order-distribution",data:a,colors:["#60bfb6","#91cdec","#eceff1"]})},changeData:function(a){var b=$(a.currentTarget),c=b.parent("div.btn-group"),d=b.attr("data-value");if(c.find("button.active").removeClass("active"),b.addClass("active"),"month"==d)var e=this.formatOrderOverviewData(Backend.data.orders.month);else if("week"==d)var e=this.formatOrderOverviewData(Backend.data.orders.week);else if("day"==d)var e=this.formatOrderOverviewData(Backend.data.orders.day);this.drawOverviewChart(e)}});
Backend.Views.CuisinesView=Backbone.View.extend({el:"#app",ui:{list:".cuisine-list",addBtn:"#add-btn",name:"#name",slug:"#slug"},events:{"click .remove-cuisine":"removeCuisine","click #add-btn":"addCuisine","keydown #name":"onNameKeydown"},setUpUi:function(){var a=this;_.each(_.keys(a.ui),function(b){var c=a.ui[b];this.ui[b]=$(c)},this)},initialize:function(){this.setUpUi(),this.collection=new Backbone.Collection,this.collection.on("reset",this.addAll,this),this.collection.on("remove",this.addAll,this),this.collection.on("add",this.addOne,this),this.collection.reset(cuisines)},addAll:function(){this.ui.list.html(""),this.collection.each(this.addOne,this)},addOne:function(a){var b=$("#cuisine-tmpl").html(),c=_.template(b);this.ui.list.prepend(c(a.toJSON()))},removeCuisine:function(a){var b=$(a.currentTarget),c=b.attr("data-id");url=Backend.Constants.url+"/cuisines/remove/"+c,self=this,$.ajax({url:url,type:"GET",dataType:"json",success:function(a){if("success"==a.status){var b=self.collection.get(c);self.collection.remove(b),alert(a.message)}}}),a.preventDefault()},addCuisine:function(a){var b=$(a.currentTarget),c=Backend.Constants.url+"/cuisines/add";data={name:this.ui.name.val(),slug:this.ui.slug.val()},self=this,b.prop("disabled",!0),b.html("Adding..."),$.ajax({url:c,type:"POST",data:data,dataType:"json",success:function(a,b,c){self.addSuccess(a,b,c,self)}})},addSuccess:function(a,b,c,d){"success"==a.status&&(d.ui.addBtn.prop("disabled",!1),d.ui.addBtn.html("Add"),d.ui.name.val(""),d.ui.slug.val(""),d.collection.add(a.model))},onNameKeydown:function(a){var b=$(a.currentTarget),c=b.val(),d=c.toLowerCase();this.ui.slug.val(d)}});
Backend.Views.RestuarantFormView=Backbone.View.extend({el:"#app",ui:{form:"#user-form",logopreview:".logo-thumbnail",city:"#city",area:"#area",logistics:"#logistics-info"},events:{"change #city":"onCityChange","change #deliveries":"onDeliveriesChange","change #pickups":"onPickupChange","click .remove-trigger":"removeLogo","click #upload-btn":"uploadLogo"},validationRules:{name:{required:!0},address:{required:!0},minimuim_order:{required:!0,number:!0},email:{required:!0,email:!0},phone:{required:!0,number:!0},delivery_fee:{number:!0}},setUpUi:function(){var a=this;_.each(_.keys(a.ui),function(b){var c=a.ui[b];this.ui[b]=$(c)},this)},initUploader:function(){var a=new plupload.Uploader({runtimes:"html5,flash",browse_button:"upload-trigger",url:Backend.Constants.url+"/upload",max_file_size:"1mb",filters:[{title:"Image files",extensions:"jpg,gif,png"}],flash_swf_url:Backend.Constants.url+"/js/plugins/plupload/Moxie.swf",unique_names:!0,file_data_name:"logo"});this.uploader=a,this.uploader.init(),this.uploader.bind("FilesAdded",this.logoAdded,this),this.uploader.bind("FileUploaded",this.logoUploaded,this)},logoAdded:function(a,b){var c=$(".logo-thumbnail"),d=c.find(".remove-trigger"),e=$("#upload-btn");c.find("canvas").remove(),c.find("img").remove(),e.show(),$.each(b,function(){var a=new mOxie.Image;a.onload=function(){this.embed(c.get(0),{width:300,height:200,crop:!1})},a.onembedded=function(){this.destroy()},a.onerror=function(){this.destroy()},a.load(this.getSource())}),d.show()},logoUploaded:function(a,b,c){var d=$.parseJSON(c.response);"success"==d.status&&($("#upload-btn").html('<i class="icon-cloud-upload"></i> Uploaded').delay(3e3).hide(),$("#upload-btn").html('<i class="icon-cloud-upload"></i> Upload'),$("input#logo").val(d.file.path))},initialize:function(){this.setUpUi(),this.initUploader(),this.bindPlugins(),this.cities=new Backbone.Collection,this.cities.reset(locales),this.populateCityDropdown()},bindFormValidation:function(){this.ui.form.validate({rules:this.validationRules,onfocusout:function(a){$(a).valid()},errorPlacement:function(a,b){$('<span class="error"></span>').insertAfter(b).append(a);var c=$(b).parent(".controls");c.removeClass("success-control").addClass("error-control")},success:function(a,b){var c=$(b).parent(".controls");c.removeClass("error-control").addClass("success-control")},submitHandler:function(a){a.submit()}})},bindPlugins:function(){$(".timepicker-default").timepicker(),this.bindFormValidation();var a=$("#deliveries"),b=$("#pickups");if("1"==a.attr("data-checked")){var c=$("#delivery-info");a.prop("checked",!0),this.ui.logistics.show(),c.show()}if("1"==b.attr("data-checked")){var c=$("#pickup-info");b.prop("checked",!0),this.ui.logistics.show(),c.show()}},onCityChange:function(a){var b=$(a.currentTarget),c=b.val(),d=this.cities.get(c);areas=d.get("areas"),this.populateAreaDropdown(areas)},populateCityDropdown:function(){var a=this;if(this.cities.each(function(b){a.ui.city.append('<option value="'+b.id+'">'+b.get("name")+"</option>")}),"none"!=this.ui.city.attr("data-select")){{var b=this.ui.city.attr("data-select");this.ui.city.find('option[value="'+b+'"]').prop("selected",!0)}city=this.cities.get(b),areas=city.get("areas"),this.populateAreaDropdown(areas)}},populateAreaDropdown:function(a){var b=this;if(this.ui.area.removeAttr("disabled"),_.each(a,function(a){b.ui.area.append('<option value="'+a.id+'">'+a.name+"</option>")}),"none"!=this.ui.area.attr("data-select")){var c=this.ui.area.attr("data-select");this.ui.area.find('option[value="'+c+'"]').prop("selected",!0)}},onDeliveriesChange:function(a){var b=$(a.currentTarget),c=$("#delivery-info"),d=$("#pickups");b.prop("checked")?(c.show(),this.ui.logistics.is(":visible")||this.ui.logistics.slideDown()):(c.hide(),d.prop("checked")||this.ui.logistics.slideUp())},onPickupChange:function(a){var b=$(a.currentTarget),c=$("#pickup-info"),d=$("#deliveries");b.prop("checked")?(c.show(),this.ui.logistics.is(":visible")||this.ui.logistics.slideDown()):(c.hide(),d.prop("checked")||this.ui.logistics.slideUp())},removeLogo:function(a){var b=$(a.currentTarget);"true"==b.attr("data-hide")?b.hide():this.ui.logopreview.find("a.remove-trigger").hide(),$("#upload-btn").hide(),this.ui.logopreview.find("canvas").remove(),this.ui.logopreview.find("img").remove(),$("#logo").val(""),a.preventDefault()},uploadLogo:function(a){var b=$(a.currentTarget);b.html('<i class="icon-cloud-upload"></i> Uploading...'),b.attr("disabled","disabled"),this.uploader.start()}});
Backend.Views.RestuarantStaffView=Backbone.View.extend({el:"#app",ui:{empty:".empty",list:".staff-list",name:"#name"},events:{"click #add-btn":"onAddBtnClick","click .remove-staff":"onRemoveStaffClick"},setUpUi:function(){var a=this;_.each(_.keys(a.ui),function(b){var c=a.ui[b];this.ui[b]=$(c)},this)},bindPlugins:function(){this.ui.name.typeahead({source:users})},initialize:function(){this.setUpUi(),this.bindPlugins(),this.staff=new Backbone.Collection,this.staff.on("reset",this.addAll,this),this.staff.on("remove",this.addAll,this),this.staff.on("add",this.addOne,this),this.staff.reset(staff)},addOne:function(a){var b=$("#staff-tmpl").html(),c=_.template(b);this.ui.list.prepend(c(a.toJSON()))},addAll:function(){console.log(this.staff),this.staff.length>0?(this.ui.list.html(""),this.staff.each(this.addOne,this)):this.ui.empty.show()},onAddBtnClick:function(){var a=Backend.Constants.url+"/restaurants/"+rid+"/staff/add",b={name:this.ui.name.val()},c=this,d=$("#add-btn");d.prop("disabled",!0),d.html("Adding"),$.ajax({url:a,data:b,type:"POST",dataType:"json",success:function(a,b,d){c.addSuccess(a,b,d,c)}})},onRemoveStaffClick:function(a){var b=$(a.currentTarget),c=b.attr("data-id"),d=Backend.Constants.url+"/restaurants/"+rid+"/staff/remove/"+c,e=this;$.ajax({url:d,type:"GET",dataType:"json",success:function(a){if("success"==a.status){var b=e.staff.get(c);e.staff.remove(b),alert(a.message)}}}),a.preventDefault()},addSuccess:function(a,b,c,d){if("success"==a.status){var e=$("#add-btn"),f=$("#name");e.html("Add"),e.prop("disabled",!1),f.val(""),d.staff.add(a.model)}else if("error"==a.status){var e=$("#add-btn"),f=$("#name");e.html("Add"),e.prop("disabled",!1),f.val(""),alert(a.message)}}});
Backend.Views.UserFormView=Backbone.View.extend({el:"#app",validationRules:{firstname:{required:!0},lastname:{required:!0},password:{required:!0,minlength:6},confpassword:{required:!0,minlength:6,equalTo:"#password"},email:{required:!0,email:!0}},validationMessages:{firstname:"Please enter your first name",lastname:"Please enter your last name",email:{required:"Please enter an e-mail address",email:"Please enter a valid e-mail address"},password:{required:"Please enter a password",minlength:"Your password must have at least 6 characters"},confpassword:{required:"Please confirm your password",minlength:"Your password must have at least 6 characters",equalTo:"Your passwords do not match"}},ui:{form:"#user-form"},setUpUi:function(){var a=this;_.each(_.keys(a.ui),function(b){var c=a.ui[b];this.ui[b]=$(c)},this)},bindPlugins:function(){var a=this;this.ui.form.validate({errorElement:"span",errorClass:"error",rules:a.validationRules,messages:a.validationMessages,onfocusout:function(a){$(a).valid()},invalidHandler:function(){},errorPlacement:function(a,b){$('<span class="error"></span>').insertAfter(b).append(a)},success:function(a,b){var c=$(b).siblings("span");c.each(function(){$(this).remove()})},submitHandler:function(a){a.submit()}})},initialize:function(){this.setUpUi(),this.bindPlugins()}});