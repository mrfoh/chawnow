Backend.Views.RestuarantStaffView=Backbone.View.extend({el:"#app",ui:{empty:".empty",list:".staff-list",name:"#name"},events:{"click #add-btn":"onAddBtnClick","click .remove-staff":"onRemoveStaffClick"},setUpUi:function(){var a=this;_.each(_.keys(a.ui),function(b){var c=a.ui[b];this.ui[b]=$(c)},this)},bindPlugins:function(){this.ui.name.typeahead({source:users})},initialize:function(){this.setUpUi(),this.bindPlugins(),this.staff=new Backbone.Collection,this.staff.on("reset",this.addAll,this),this.staff.on("remove",this.addAll,this),this.staff.on("add",this.addOne,this),this.staff.reset(staff)},addOne:function(a){var b=$("#staff-tmpl").html(),c=_.template(b);this.ui.list.prepend(c(a.toJSON()))},addAll:function(){console.log(this.staff),this.staff.length>0?(this.ui.list.html(""),this.staff.each(this.addOne,this)):this.ui.empty.show()},onAddBtnClick:function(){var a=Backend.Constants.url+"/restaurants/"+rid+"/staff/add",b={name:this.ui.name.val()},c=this,d=$("#add-btn");d.prop("disabled",!0),d.html("Adding"),$.ajax({url:a,data:b,type:"POST",dataType:"json",success:function(a,b,d){c.addSuccess(a,b,d,c)}})},onRemoveStaffClick:function(a){var b=$(a.currentTarget),c=b.attr("data-id"),d=Backend.Constants.url+"/restaurants/"+rid+"/staff/remove/"+c,e=this;$.ajax({url:d,type:"GET",dataType:"json",success:function(a){if("success"==a.status){var b=e.staff.get(c);e.staff.remove(b),alert(a.message)}}}),a.preventDefault()},addSuccess:function(a,b,c,d){if("success"==a.status){var e=$("#add-btn"),f=$("#name");e.html("Add"),e.prop("disabled",!1),f.val(""),d.staff.add(a.model)}else if("error"==a.status){var e=$("#add-btn"),f=$("#name");e.html("Add"),e.prop("disabled",!1),f.val(""),alert(a.message)}}});