Backend.Views.CuisinesView=Backbone.View.extend({el:"#app",ui:{list:".cuisine-list",addBtn:"#add-btn",name:"#name",slug:"#slug"},events:{"click .remove-cuisine":"removeCuisine","click #add-btn":"addCuisine","keydown #name":"onNameKeydown"},setUpUi:function(){var a=this;_.each(_.keys(a.ui),function(b){var c=a.ui[b];this.ui[b]=$(c)},this)},initialize:function(){this.setUpUi(),this.collection=new Backbone.Collection,this.collection.on("reset",this.addAll,this),this.collection.on("remove",this.addAll,this),this.collection.on("add",this.addOne,this),this.collection.reset(cuisines)},addAll:function(){this.ui.list.html(""),this.collection.each(this.addOne,this)},addOne:function(a){var b=$("#cuisine-tmpl").html(),c=_.template(b);this.ui.list.prepend(c(a.toJSON()))},removeCuisine:function(a){var b=$(a.currentTarget),c=b.attr("data-id");url=Backend.Constants.url+"/cuisines/remove/"+c,self=this,$.ajax({url:url,type:"GET",dataType:"json",success:function(a){if("success"==a.status){var b=self.collection.get(c);self.collection.remove(b),alert(a.message)}}}),a.preventDefault()},addCuisine:function(a){var b=$(a.currentTarget),c=Backend.Constants.url+"/cuisines/add";data={name:this.ui.name.val(),slug:this.ui.slug.val()},self=this,b.prop("disabled",!0),b.html("Adding..."),$.ajax({url:c,type:"POST",data:data,dataType:"json",success:function(a,b,c){self.addSuccess(a,b,c,self)}})},addSuccess:function(a,b,c,d){"success"==a.status&&(d.ui.addBtn.prop("disabled",!1),d.ui.addBtn.html("Add"),d.ui.name.val(""),d.ui.slug.val(""),d.collection.add(a.model))},onNameKeydown:function(a){var b=$(a.currentTarget),c=b.val(),d=c.toLowerCase();this.ui.slug.val(d)}});